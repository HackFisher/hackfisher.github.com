--- 
layout: post
title: !binary |
  5Luj56CB6LSo6YeP57O75YiX5LmL5LqU77ya5Yip55SoQ29kZVBybyBBbmFs
  eXRpY+W3peWFt+ajgOa1i+WSjOWIoOmZpOmHjeWkjeS7o+eggeKAlOKAlERv
  bid0IFJlcGVhdCBZb3Vyc2VsZg==

published: true
meta: 
  _edit_last: "1"
  _wp_old_slug: "%e4%bb%a3%e7%a0%81%e8%b4%a8%e9%87%8f%e7%b3%bb%e5%88%97%e4%b9%8b%e4%ba%94%ef%bc%9a%e5%88%a9%e7%94%a8codepro-analytic%e5%b7%a5%e5%85%b7%e6%a3%80%e6%b5%8b%e5%92%8c%e5%88%a0%e9%99%a4%e9%87%8d%e5%a4%8d"
tags: 
- !binary |
  5Luj56CB6LSo6YeP

- !binary |
  5oqA5pyv566h55CG

type: post
status: publish
---
这个系列的<a title="破窗理论" href="http://www.hackfisher.info/blog/?p=55" target="_blank">上一篇文章</a>给我们介绍了破窗理论，说明代码里发现了坏味道要及时清理。而代码中最常见的坏味道就包括我们今天要说的重复代码。重复代码使得软件产品的可变更性迅速变差，复杂度增高，可读性也变差，重复的代码往往抽象度不高，说明对模型理解不够透彻。

刘未鹏同学曾经在stackoverflow.com开张不久，跑上去问过一个问题，<a href="http://mindhacks.cn/2009/03/09/first-principles-of-programming/">编程的首要原则(s)是什么</a>?结果在得到的一大堆答案中，DRY原则(Don't Repeat Yourself)位居前列。我们今天先不谈其他的编程原则，先介绍一下DRY原则的简单实践。
<p style="text-align: center;"><img src="http://www.hackfisher.info/blog/wp-content/uploads/2011/01/do_not_duplicate.jpg" alt="do-not-duplicate.jpg" width="482" height="249" /></p>
如果让我例举一个我最讨厌的编程行为，最先跳出我脑海的该是复制粘贴，如果不是我用CodePro的Find Similar Code功能对代码进行了检测，大概我自己都不相信有怎么多的重复代码隐藏在工程的某些旮旯角落。首先感谢Google将其免费开放出来，官方地址在<a href="http://code.google.com/javadevtools/download-codepro.html">http://code.google.com/javadevtools/download-codepro.html</a>。

使用说明就很简单了

1. 用Eclipse|Help|Install New Softwares功能安装这个插件。

2. 选中一些文件，或者某个文件夹，右击菜单|CodePro Tools|Find Similar Code

<img src="http://www.hackfisher.info/blog/wp-content/uploads/2011/01/step2.png" alt="step2.png" width="637" height="364" />

3. 执行查找动作，如果你是选中一个大的文件夹，Java源文件比较多的情况下，会慢一些，大概要一个小时才能好

<img src="http://www.hackfisher.info/blog/wp-content/uploads/2011/01/step3.png" alt="step3.png" width="968" height="182" />

4. 下面就可以选中某个，进行重构，清理重复代码的坏味道，如果这次没有改完的话，可以保存结果，下次继续修改时导入，就比重新执行要快的多了

5. 可以生成可读性很强的HTML报告，发送至邮件，重复代码状况一目了然。

6. 还有更多高级选项，比如对重复代码的结果设置过滤行数，更多高级用法可以在文档中找到

<a href="http://download.instantiations.com/CodeProDoc/integration/latest/docs/html/gettingstarted/using_filters.html">http://download.instantiations.com/CodeProDoc/integration/latest/docs/html/gettingstarted/using_filters.html</a>

不过需要补充的是，清理重复代码这项工作可不是项简单的工作，有时甚至可以用艰苦来形容。当时复制粘贴起来很容易，以后重构起来就要花原来几倍的时间来改。

而且，我发现，越是烂，越是难以重用的代码，越是容易被后来的人复制粘贴，复制粘贴之后就变成了更烂的代码。总结起来，就是下面的表达式：
<p style="text-align: center;"><strong style="font-size: 18px;">(x =&gt; paste(copy(x)))(烂代码) == 更烂的代码</strong></p>
更多参考资料：
<div><span class="Apple-style-span" style="widows: 2; text-transform: none; text-indent: 0px; border-collapse: separate; font: medium Simsun; white-space: normal; orphans: 2; letter-spacing: normal; color: #000000; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><span style="font-family: arial, 宋体, sans-serif;"><span style="line-height: 25px; font-size: 14px;"><a style="color: #005488;" href="http://www.cnblogs.com/wayfarer/category/272862.html" target="_blank">http://www.cnblogs.com/<wbr>wayfarer/category/272862.html</wbr></a></span></span></span></div>
<div><span style="font-family: arial, 宋体, sans-serif;"><span style="line-height: 25px; font-size: 14px;"><a style="color: #005488;" href="http://timyang.net/programming/pragmatic-programmer/" target="_blank">http://timyang.net/<wbr>programming/pragmatic-<wbr>programmer/</wbr></wbr></a></span></span></div>
<div><span style="font-family: arial, 宋体, sans-serif;"><a style="color: #005488;" href="http://www.javaeye.com/wiki/Design_Patterns/2061-coding_quantity" target="_blank">http://www.javaeye.com/wiki/<wbr>Design_Patterns/2061-coding_<wbr>quantity</wbr></wbr></a></span></div>
<div><span style="font-family: arial, 宋体, sans-serif;"><a style="color: #005488;" href="http://www.ibm.com/developerworks/cn/java/cq/" target="_blank">http://www.ibm.com/<wbr>developerworks/cn/java/cq/</wbr></a></span></div>
<div>
<div><span style="font-family: arial, 宋体, sans-serif;"><span style="line-height: 25px; font-size: 14px;"><a style="color: #005488;" href="http://teamojiao.javaeye.com/blog/455915" target="_blank">http://teamojiao.javaeye.com/<wbr>blog/455915</wbr></a></span></span></div>
<div><span style="line-height: 25px; font-size: 14px;"><a style="color: #005488;" href="http://www.baiduux.com/blog/2010/11/01/from-if-else-to-switch-case-then-to-abstraction/" target="_blank">http://www.baiduux.com/blog/<wbr>2010/11/01/from-if-else-to-<wbr>switch-case-then-to-<wbr>abstraction/</wbr></wbr></wbr></a></span></div>
<div><span style="line-height: 25px; font-size: 14px;"><a style="color: #005488;" href="http://www.cnblogs.com/wayfarer/category/272862.html" target="_blank">http://www.cnblogs.com/<wbr>wayfarer/category/272862.html</wbr></a></span></div>
</div>
